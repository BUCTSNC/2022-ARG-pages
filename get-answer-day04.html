<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/newStyle.css">
    <link rel="stylesheet" type="text/css" href="css/nav.css">
    <link rel="stylesheet" type="text/css" href="css/new_main.css">
    <link rel="stylesheet" type="text/css" href="css/code_windows.css">
    <link rel="icon" href="img/logo_1.png" type="image/x-icon">
    <link rel="shortcut icon" href="img/logo_1.png" type="image/x-icon">
    <script async defer data-website-id="0a453f1f-f1bc-4f69-9772-6a1e6cfea828" src="https://stat.buctsnc.cn/umami.js"></script>
    <title>Day 4</title>
</head>
<script src="./js/jquery.js"></script>
<script src="./js/typist.js"></script>
<body>
    <header id="nav" style="display: none">
        <img class="logo" src="img/buctlogo.png" alt="logo">
        <img class="logo" src="img/snclogo.png" alt="logo">
    </header>
    <div class="answer_div" id="submit_form" style="display: none">
        <form name="answer_form" method="post" class="answer_form" onsubmit="checkSubmit()">
            <table>
                <tr>
                    <td>用户名：</td>
                    <td><input id="nickname" name="nickname" type="text" placeholder="注册过用户名" autocomplete="off" class="text_area"></td>
                    <td>没有注册？<a href="register.html">注册</a></td>
                </tr>
                <tr>
                    <td>电话号码：</td>
                    <td><input id="contact" name="contact" type="text" placeholder="注册过的电话号码" autocomplete="off" class="text_area"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>获得的答案：</td>
                    <td><input id="answer_q4" name="answer_q4" type="text" placeholder="Day 4答案" autocomplete="off" class="text_area"></td>
                    <td>没有找到？<a href="day-04-index.html">返回</a> </td>
                </tr>
            </table>
            <div class="get_answer_button">
                <button class="gab" type="reset" onclick="">重新输入</button>
<!--                <button class="gab" type="button" onclick="submits()">提交答案</button>-->
                <button class="gab" type="button" onclick="onClick()">提交答案</button>

            </div>
        </form>
    </div>







    <!--提交后显示内容-->





</body>
<script>
    window.onload = function(){
        $("#nav").fadeIn();
        $("#submit_form").fadeIn();
    }

    let submit = false;
    function checkSubmit() {
        if(!submit) {
            // 表单提交后设置标志位
            submit = true;
            return true;
        }
        // 表单已经提交，不允许再次提交
        console.log("请不要重复提交表单！");
        return false;
    }

    function isLegalName (str) {
        let re = /^[0-9a-zA-Z]*$/;
        if (!re.test(str) || str.indexOf(" ") != -1) {
            return false;
        } else {
            return true;
        }
    }

    function isLegalTel(str) {
        let re = /^[0-9|+]*$/;
        if (!re.test(str) || str.indexOf(" ") != -1) {
            return false;
        } else {
            return true;
        }
    }

    function check(nickname, contact, answer_q3) {
        if(nickname.length < 1 || contact.length < 10 || answer_q3.length < 1){
            return false;
        }
        return true;
    }
    function submits() {
        let nickname = document.getElementById("nickname")
        let contact = document.getElementById("contact")
        let answer_q3 = document.getElementById("answer_q3")
        if(check(nickname.value, contact.value, answer_q3.value) && isLegalName(nickname.value) && isLegalTel(contact.value)){
            $.ajax({
                url:"https://sncdeveloper.cn:8000/argProject/day03",
                // url:"http://127.0.0.1:8000/ARG/day03",
                method:"post",
                async:"false",
                data:{"nickname":nickname.value,"contact":contact.value,"answer_q3":answer_q3.value},
                dataType:"json",
                contentType:"application/x-www-form-urlencoded",
                success(result){
                    nickname.value = ""
                    contact.value = ""
                    answer_q3.value = ""
                    window.alert(result.msg)
                    if(result.data.solveStatus=="####"){ //不做成功提交后的打字机效果



                    }
                },
                error(msg){
                    console.log("error"+msg)
                    window.alert("活动太火爆了，请稍后再试")
                }
            })
        }else{
            if (!isLegalName(nickname.value))
                alert("用户名只能由数字和字母组成！");
            else
                alert("联系方式格式有误或答案为空，请重新输入")
        }
    }


    function onClick() {
        $("#submit_form").fadeOut();

        let source = document.getElementById('input');
        let output = document.getElementById('output');
        let typing = new Typing({
            source,
            output,
            delay: 15
        });


    }



</script>

</html>